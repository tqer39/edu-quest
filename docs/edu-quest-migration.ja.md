# EduQuest ç§»è¡Œè¨ˆç”»

## æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ç®—æ•°ç‰¹åŒ–ã® **MathQuest** ã‹ã‚‰è¤‡æ•°æ•™ç§‘ã‚’æ‰±ã† **EduQuest** ã¸ç§»è¡Œã™ã‚‹ãŸã‚ã®è©³ç´°ãªè¨ˆç”»ã‚’ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:** è¨ˆç”»ç­–å®šä¸­
**å®Œäº†ç›®æ¨™:** æœªå®š
**ç¾è¡Œãƒ‰ãƒ¡ã‚¤ãƒ³:** mathquest.app
**ç§»è¡Œå…ˆãƒ‰ãƒ¡ã‚¤ãƒ³:** edu-quest.app

---

## ç›®æ¬¡

1. [ãƒ“ã‚¸ãƒ§ãƒ³ã¨ç›®æ¨™](#ãƒ“ã‚¸ãƒ§ãƒ³ã¨ç›®æ¨™)
2. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦)
3. [ç§»è¡Œãƒ•ã‚§ãƒ¼ã‚º](#ç§»è¡Œãƒ•ã‚§ãƒ¼ã‚º)
4. [æŠ€è¡“çš„å®Ÿè£…](#æŠ€è¡“çš„å®Ÿè£…)
5. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã®é€²åŒ–](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã®é€²åŒ–)
6. [ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥](#ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥)
7. [ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨ˆç”»](#ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨ˆç”»)
8. [æˆåŠŸæŒ‡æ¨™](#æˆåŠŸæŒ‡æ¨™)

---

## ãƒ“ã‚¸ãƒ§ãƒ³ã¨ç›®æ¨™

### ç¾çŠ¶

- **MathQuest:** å°å­¦ç”Ÿå‘ã‘ç®—æ•°ç·´ç¿’ã‚¢ãƒ—ãƒª
- å˜ä¸€ãƒ‰ãƒ¡ã‚¤ãƒ³: `mathquest.app`
- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯ç®—æ•°ã®ã¿ï¼ˆãŸã—ç®—ãƒ»ã²ãç®—ãƒ»ã‹ã‘ç®—ãƒ»ã‚ã‚Šç®—ï¼‰
- æ—¥æ¬¡ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼ç´„ 1,000ï¼ˆä»®æŒ‡æ¨™ï¼‰

### ç›®æ¨™åƒ

- **EduQuest:** ç·åˆå­¦ç¿’ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 
- æ•™ç§‘ã”ã¨ã®ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’æŒã¤ãƒãƒ«ãƒãƒ‰ãƒ¡ã‚¤ãƒ³æ§‹æˆ
- å¯¾å¿œæ•™ç§‘: ç®—æ•°ãƒ»æ¼¢å­—ãƒ»ã‹ãªï¼ˆå°†æ¥çš„ãªæ•™ç§‘ã‚‚æƒ³å®šï¼‰
- å…±é€šèªè¨¼ã«ã‚ˆã‚‹çµ±ä¸€ UX

### æˆåŠŸæ¡ä»¶

- ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãªã—
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®æå¤±ãªã—
- ç¾è¡Œãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™ã®ç¶­æŒã¾ãŸã¯å‘ä¸Š
- æ•™ç§‘ã‚’ã¾ãŸã„ã ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªä½“é¨“

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### ç¾è¡Œã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```text
mathquest.app
â””â”€â”€ Cloudflare Workers (Hono SSR)
    â”œâ”€â”€ /start
    â”œâ”€â”€ /play
    â””â”€â”€ /apis/quiz
```

### ç›®æ¨™ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```text
edu-quest.app (ãƒãƒ¼ã‚¿ãƒ« - Cloudflare Pages)
â”œâ”€â”€ / (æ•™ç§‘é¸æŠä»˜ããƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°)
â”œâ”€â”€ /about
â””â”€â”€ /account

math.edu-quest.app (ç®—æ•°ã‚¢ãƒ—ãƒª - Cloudflare Workers)
â”œâ”€â”€ /start
â”œâ”€â”€ /play
â””â”€â”€ /apis/quiz

kanji.edu-quest.app (æ¼¢å­—ã‚¢ãƒ—ãƒª - Cloudflare Workers)
â”œâ”€â”€ /start
â”œâ”€â”€ /play
â””â”€â”€ /apis/quiz

kana.edu-quest.app (ã‹ãªã‚¢ãƒ—ãƒª - Cloudflare Workers)
â”œâ”€â”€ /start
â”œâ”€â”€ /play
â””â”€â”€ /apis/quiz
```

### æƒ³å®šã‚¹ã‚¿ãƒƒã‚¯

```text
ãƒãƒ¼ã‚¿ãƒ« (edu-quest.app):
  - Cloudflare Pages ä¸Šã® Next.js
  - ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ã¯é™çš„ç”Ÿæˆ
  - å…±é€šèªè¨¼ã‚µãƒ¼ãƒ“ã‚¹

æ•™ç§‘ã‚¢ãƒ—ãƒª (*.edu-quest.app):
  - Cloudflare Workers ä¸Šã® Honoï¼ˆç¾è¡Œã‚¹ã‚¿ãƒƒã‚¯ï¼‰
  - D1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆæ•™ç§‘åˆ¥ or å…±æœ‰ï¼‰
  - KVï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼‰
```

---

## ç§»è¡Œãƒ•ã‚§ãƒ¼ã‚º

### ãƒ•ã‚§ãƒ¼ã‚º1: åŸºç›¤æ•´å‚™ï¼ˆ1ã€œ2é€±ï¼‰

**ç›®çš„:** ãƒ‰ãƒ¡ã‚¤ãƒ³å–å¾—ã¨åŸºç›¤æ§‹ç¯‰

**ã‚¿ã‚¹ã‚¯:**

- [ ] `edu-quest.app` ãƒ‰ãƒ¡ã‚¤ãƒ³å–å¾—
- [ ] Cloudflare ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ãƒ‰ãƒ¡ã‚¤ãƒ³è¿½åŠ 
- [ ] DNS ãƒ¬ã‚³ãƒ¼ãƒ‰è¨­å®š

  ```text
  edu-quest.app           â†’ Cloudflare Pages
  *.edu-quest.app         â†’ ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ SSL
  math.edu-quest.app      â†’ Cloudflare Workers
  www.edu-quest.app       â†’ edu-quest.app ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  ```

- [ ] Terraform ã§ DNS ç®¡ç†ã‚’æ§‹ç¯‰
- [ ] ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®å‹•ä½œç¢ºèª

**æˆæœç‰©:**

- æ­£ã—ãæ©Ÿèƒ½ã™ã‚‹ DNS è¨­å®š
- å…¨ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ç”¨ SSL è¨¼æ˜æ›¸
- `infra/terraform/dns.tf` å†…ã® Terraform ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

**æ¤œè¨¼:**

- [ ] `edu-quest.app` ãŒæ­£ã—ãè§£æ±ºã™ã‚‹
- [ ] `math.edu-quest.app` ãŒæ­£ã—ãè§£æ±ºã™ã‚‹
- [ ] SSL è¨¼æ˜æ›¸ãŒæœ‰åŠ¹

---

### ãƒ•ã‚§ãƒ¼ã‚º2: MathQuest ç§»è¡Œï¼ˆ3ã€œ4é€±ï¼‰

**ç›®çš„:** ç¾è¡Œã‚¢ãƒ—ãƒªã‚’ math.edu-quest.app ã«ç§»è¨­

**ã‚¿ã‚¹ã‚¯:**

- [ ] `math.edu-quest.app` ç”¨ `wrangler.toml` ä½œæˆ
- [ ] ç’°å¢ƒå¤‰æ•°ãƒ»ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæ›´æ–°
- [ ] æ–°ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã¸ãƒ‡ãƒ—ãƒ­ã‚¤
- [ ] å…¨æ©Ÿèƒ½ã®å‹•ä½œãƒ†ã‚¹ãƒˆ
- [ ] `mathquest.app` â†’ `math.edu-quest.app` ã® 301 ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
- [ ] åˆ†æãƒ»ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°æ›´æ–°

**ã‚³ãƒ¼ãƒ‰å¤‰æ›´ä¾‹:**

```typescript
// infra/terraform/redirects.tf
resource "cloudflare_worker_route" "mathquest_redirect" {
  zone_id     = var.cloudflare_zone_id_mathquest
  pattern     = "mathquest.app/*"
  script_name = "mathquest-redirect"
}

// apps/mathquest-redirect/src/index.ts
export default {
  async fetch(request: Request): Promise<Response> {
    const url = new URL(request.url);
    const newUrl = `https://math.edu-quest.app${url.pathname}${url.search}`;
    return Response.redirect(newUrl, 301);
  }
};
```

**æˆæœç‰©:**

- ç¨¼åƒä¸­ã® `math.edu-quest.app`
- æ­£å¸¸ã«å‹•ä½œã™ã‚‹ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
- æ›´æ–°ã•ã‚ŒãŸãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

**æ¤œè¨¼:**

- [ ] `math.edu-quest.app` ã§å…¨ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] èªè¨¼ãŒæ©Ÿèƒ½ã™ã‚‹
- [ ] ã‚¯ã‚¤ã‚ºæ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹
- [ ] DB ã®èª­ã¿æ›¸ããŒæˆåŠŸã™ã‚‹
- [ ] `mathquest.app` ãŒæ­£ã—ããƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹

---

### ãƒ•ã‚§ãƒ¼ã‚º3: ãƒãƒ¼ã‚¿ãƒ«é–‹ç™ºï¼ˆ5ã€œ8é€±ï¼‰

**ç›®çš„:** edu-quest.app ã«ãƒãƒ¼ã‚¿ãƒ«ã‚’æ§‹ç¯‰

**ã‚¿ã‚¹ã‚¯:**

- [ ] æ–°ã‚¢ãƒ—ãƒª `apps/portal/` ä½œæˆ
- [ ] Cloudflare Pages å‘ã‘ Next.js è¨­å®š
- [ ] ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸è¨­è¨ˆã¨å®Ÿè£…
- [ ] æ•™ç§‘é¸æŠ UIï¼ˆç®—æ•°ãƒ»æ¼¢å­—ãƒ»ã‹ãªã‚«ãƒ¼ãƒ‰ï¼‰
- [ ] å…±é€šèªè¨¼ã‚·ã‚¹ãƒ†ãƒ 
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†
- [ ] `edu-quest.app` ã¸ãƒ‡ãƒ—ãƒ­ã‚¤

**ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ:**

```text
apps/portal/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ page.tsx              # ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ about/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â””â”€â”€ account/
â”‚       â””â”€â”€ page.tsx
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ SubjectCard.tsx       # æ•™ç§‘é¸æŠã‚«ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ Header.tsx
â”‚   â””â”€â”€ Footer.tsx
â”œâ”€â”€ public/
â”‚   â””â”€â”€ images/
â””â”€â”€ package.json
```

**ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ä¾‹:**

```tsx
// apps/portal/app/page.tsx
export default function Home() {
  return (
    <main>
      <Hero title="EduQuest" subtitle="å­¦ã³ã®å†’é™ºã‚’ã¯ã˜ã‚ã‚ˆã†" />

      <SubjectGrid>
        <SubjectCard
          title="ç®—æ•°ã‚¯ã‚¨ã‚¹ãƒˆ"
          icon="ğŸ”¢"
          description="è¨ˆç®—åŠ›ã‚’é›ãˆã‚ˆã†"
          href="https://math.edu-quest.app"
          available
        />

        <SubjectCard
          title="æ¼¢å­—ã‚¯ã‚¨ã‚¹ãƒˆ"
          icon="ğŸ“"
          description="æ¼¢å­—ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã‚ˆã†"
          href="https://kanji.edu-quest.app"
          comingSoon
        />

        <SubjectCard
          title="ã²ã‚‰ãŒãªã‚¯ã‚¨ã‚¹ãƒˆ"
          icon="âœï¸"
          description="ã²ã‚‰ãŒãªã‚’è¦šãˆã‚ˆã†"
          href="https://kana.edu-quest.app"
          comingSoon
        />
      </SubjectGrid>
    </main>
  );
}
```

**æˆæœç‰©:**

- `edu-quest.app` ã®å…¬é–‹ãƒãƒ¼ã‚¿ãƒ«
- æ•™ç§‘é¸æŠã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- Better Auth ã«ã‚ˆã‚‹å…±é€šèªè¨¼

**æ¤œè¨¼:**

- [ ] ãƒãƒ¼ã‚¿ãƒ«ãŒå„ãƒ‡ãƒã‚¤ã‚¹ã§è¡¨ç¤ºã§ãã‚‹
- [ ] math.edu-quest.app ã¸ã®ãƒªãƒ³ã‚¯ãŒæ©Ÿèƒ½ã™ã‚‹
- [ ] èªè¨¼ãŒã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³é–“ã§ç¶­æŒã•ã‚Œã‚‹
- [ ] SEO ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãŒé©åˆ‡

---

### ãƒ•ã‚§ãƒ¼ã‚º4: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å†è¨­è¨ˆï¼ˆ9ã€œ12é€±ï¼‰

**ç›®çš„:** è¤‡æ•°æ•™ç§‘å¯¾å¿œã®å…±é€šåŒ–

**ã‚¿ã‚¹ã‚¯:**

- [ ] å…±é€šãƒ­ã‚¸ãƒƒã‚¯ã‚’ `@eduquest/core` ã¸åˆ‡ã‚Šå‡ºã—
- [ ] ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã®å¤‰æ›´: `@mathquest/*` â†’ `@eduquest/*`
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã®æŠ½è±¡åŒ–
- [ ] æ•™ç§‘éä¾å­˜ã®å‹ã‚’å®šç¾©
- [ ] ã™ã¹ã¦ã® import ã‚’æ›´æ–°

**å¤‰æ›´å‰ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹æˆ:**

```text
packages/
â”œâ”€â”€ domain/        # @mathquest/domain
â””â”€â”€ app/           # @mathquest/app
```

**å¤‰æ›´å¾Œã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹æˆ:**

```text
packages/
â”œâ”€â”€ core/          # @eduquest/coreï¼ˆå…±é€šãƒ­ã‚¸ãƒƒã‚¯ï¼‰
â”œâ”€â”€ math/          # @eduquest/mathï¼ˆç®—æ•°ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰
â”œâ”€â”€ kanji/         # @eduquest/kanjiï¼ˆæ¼¢å­—ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰
â”œâ”€â”€ kana/          # @eduquest/kanaï¼ˆã‹ãªãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰
â”œâ”€â”€ ui/            # @eduquest/uiï¼ˆå…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰
â””â”€â”€ auth/          # @eduquest/authï¼ˆèªè¨¼ï¼‰
```

**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã®é€²åŒ–:**

```sql
-- ç¾è¡Œ: ç®—æ•°ç‰¹åŒ–
CREATE TABLE quiz_results (
  id TEXT PRIMARY KEY,
  grade_id TEXT NOT NULL,
  mode TEXT NOT NULL,        -- 'add', 'sub', 'mul', 'div'
  operand_a INTEGER,
  operand_b INTEGER,
  operator TEXT,
  correct_answer INTEGER,
  user_answer INTEGER,
  is_correct INTEGER,
  created_at INTEGER
);

-- å°†æ¥: è¤‡æ•°æ•™ç§‘å¯¾å¿œ
CREATE TABLE learning_sessions (
  id TEXT PRIMARY KEY,
  user_id TEXT,
  subject TEXT NOT NULL,     -- 'math', 'kanji', 'kana'
  grade_id TEXT,
  created_at INTEGER
);

CREATE TABLE learning_results (
  id TEXT PRIMARY KEY,
  session_id TEXT REFERENCES learning_sessions(id),
  subject TEXT NOT NULL,

  -- ç®—æ•°å‘ã‘ï¼ˆä»–æ•™ç§‘ã§ã¯ NULLï¼‰
  mode TEXT,
  operand_a INTEGER,
  operand_b INTEGER,
  operator TEXT,

  -- æ¼¢å­—å‘ã‘ï¼ˆä»–æ•™ç§‘ã§ã¯ NULLï¼‰
  kanji TEXT,
  reading TEXT,
  meaning TEXT,

  -- å…±é€šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  correct_answer TEXT NOT NULL,
  user_answer TEXT NOT NULL,
  is_correct INTEGER NOT NULL,
  created_at INTEGER NOT NULL
);
```

**å‹å®šç¾©ä¾‹:**

```typescript
// packages/core/src/types/subject.ts
export type SubjectType = 'math' | 'kanji' | 'kana';

export interface BaseQuestion {
  id: string;
  subject: SubjectType;
  gradeId: string;
  difficulty: number;
}

// packages/math/src/types.ts
export interface MathQuestion extends BaseQuestion {
  subject: 'math';
  a: number;
  b: number;
  op: '+' | '-' | 'Ã—' | 'Ã·';
  answer: number;
  extras?: ExtraStep[];
}

// packages/kanji/src/types.ts
export interface KanjiQuestion extends BaseQuestion {
  subject: 'kanji';
  kanji: string;
  readings: string[];
  correctReading: string;
}
```

**æˆæœç‰©:**

- æ–°ã—ã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹æˆ
- æ›´æ–°ã•ã‚ŒãŸ import ã¨ã‚³ãƒ¼ãƒ‰
- æŠ½è±¡åŒ–ã•ã‚ŒãŸ DB ã‚¹ã‚­ãƒ¼ãƒ
- æ•™ç§‘ã”ã¨ã®å‹å®‰å…¨ãªå–ã‚Šæ‰±ã„

**æ¤œè¨¼:**

- [ ] ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šé
- [ ] import ã‚¨ãƒ©ãƒ¼ãªã—
- [ ] ç®—æ•°ã‚¢ãƒ—ãƒªãŒå‹•ä½œã—ç¶šã‘ã‚‹
- [ ] DB ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒæˆåŠŸ

---

### ãƒ•ã‚§ãƒ¼ã‚º5: æ–°æ•™ç§‘ã‚¢ãƒ—ãƒªé–‹ç™ºï¼ˆ13é€±ä»¥é™ï¼‰

**ç›®çš„:** æ¼¢å­—ãƒ»ã‹ãªã‚¢ãƒ—ãƒªã®å®Ÿè£…

**ã‚¿ã‚¹ã‚¯:**

- [ ] `apps/kanji/` ã‚’ä½œæˆï¼ˆ`apps/edge/` ã‚’ãƒ™ãƒ¼ã‚¹ã«ã‚³ãƒ”ãƒ¼ï¼‰
- [ ] æ¼¢å­—å•é¡Œç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
- [ ] æ¼¢å­—ç·´ç¿’ UI è¨­è¨ˆ
- [ ] `kanji.edu-quest.app` ã¸ãƒ‡ãƒ—ãƒ­ã‚¤
- [ ] `apps/kana/` ã‚’ä½œæˆ
- [ ] ã‹ãªå•é¡Œç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
- [ ] `kana.edu-quest.app` ã¸ãƒ‡ãƒ—ãƒ­ã‚¤

**æ¼¢å­—ã‚¢ãƒ—ãƒªæ§‹æˆä¾‹:**

```text
apps/kanji/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ start.tsx
â”‚   â”‚   â”‚   â””â”€â”€ play.tsx
â”‚   â”‚   â””â”€â”€ apis/
â”‚   â”‚       â””â”€â”€ quiz.ts
â”‚   â”œâ”€â”€ application/
â”‚   â”‚   â””â”€â”€ usecases/
â”‚   â”‚       â””â”€â”€ kanji-quiz.ts
â”‚   â””â”€â”€ infrastructure/
â”‚       â””â”€â”€ database/
â””â”€â”€ wrangler.toml
```

**æˆæœç‰©:**

- ç¨¼åƒã™ã‚‹ `kanji.edu-quest.app`
- ç¨¼åƒã™ã‚‹ `kana.edu-quest.app`
- ãƒãƒ¼ã‚¿ãƒ«ã‹ã‚‰ã®ãƒªãƒ³ã‚¯æ›´æ–°

**æ¤œè¨¼:**

- [ ] æ¼¢å­—å•é¡ŒãŒæ­£ã—ãç”Ÿæˆã•ã‚Œã‚‹
- [ ] ã‹ãªå•é¡ŒãŒæ­£ã—ãç”Ÿæˆã•ã‚Œã‚‹
- [ ] ãƒãƒ¼ã‚¿ãƒ«ã‹ã‚‰ä¸¡ã‚¢ãƒ—ãƒªã¸é·ç§»ã§ãã‚‹
- [ ] æ•™ç§‘ã”ã¨ã«å­¦ç¿’é€²æ—ãŒè¨˜éŒ²ã•ã‚Œã‚‹

---

## æŠ€è¡“çš„å®Ÿè£…

### Cloudflare Workers ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

```typescript
// apps/edge/src/index.ts (å…¨ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒ«ãƒ¼ã‚¿ãƒ¼)
import { Hono } from 'hono';

const app = new Hono();

export default {
  async fetch(request: Request, env: Env): Promise<Response> {
    const url = new URL(request.url);
    const hostname = url.hostname;

    // ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã”ã¨ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
    if (hostname === 'math.edu-quest.app') {
      return handleMathApp(request, env);
    }

    if (hostname === 'kanji.edu-quest.app') {
      return handleKanjiApp(request, env);
    }

    if (hostname === 'kana.edu-quest.app') {
      return handleKanaApp(request, env);
    }

    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 404
    return new Response('Not Found', { status: 404 });
  },
};
```

### DNS è¨­å®šï¼ˆTerraformï¼‰

```hcl
# infra/terraform/dns.tf

variable "eduquest_zone_id" {
  description = "Cloudflare Zone ID for edu-quest.app"
  type        = string
}

# ãƒ«ãƒ¼ãƒˆãƒ‰ãƒ¡ã‚¤ãƒ³ â†’ ãƒãƒ¼ã‚¿ãƒ«ï¼ˆCloudflare Pagesï¼‰
resource "cloudflare_record" "root" {
  zone_id = var.eduquest_zone_id
  name    = "@"
  type    = "CNAME"
  value   = "eduquest-portal.pages.dev"
  proxied = true
}

# www â†’ ãƒ«ãƒ¼ãƒˆã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
resource "cloudflare_record" "www" {
  zone_id = var.eduquest_zone_id
  name    = "www"
  type    = "CNAME"
  value   = "edu-quest.app"
  proxied = true
}

# ç®—æ•°ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ â†’ Workers
resource "cloudflare_record" "math" {
  zone_id = var.eduquest_zone_id
  name    = "math"
  type    = "CNAME"
  value   = "eduquest-math.workers.dev"
  proxied = true
}

# æ¼¢å­—ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ â†’ Workers
resource "cloudflare_record" "kanji" {
  zone_id = var.eduquest_zone_id
  name    = "kanji"
  type    = "CNAME"
  value   = "eduquest-kanji.workers.dev"
  proxied = true
}

# ã‹ãªã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ â†’ Workers
resource "cloudflare_record" "kana" {
  zone_id = var.eduquest_zone_id
  name    = "kana"
  type    = "CNAME"
  value   = "eduquest-kana.workers.dev"
  proxied = true
}
```

### å…±é€šèªè¨¼

```typescript
// packages/auth/src/index.ts
import { betterAuth } from 'better-auth';

export const auth = betterAuth({
  database: env.DB,
  emailAndPassword: {
    enabled: true,
  },
  session: {
    cookieName: 'eduquest_session',
    domain: '.edu-quest.app', // å…¨ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã§å…±æœ‰
  },
});
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã®é€²åŒ–

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥

1. **å¾Œæ–¹äº’æ›ã®å¤‰æ›´:** æ—¢å­˜ã‚«ãƒ©ãƒ ã‚’æ®‹ã—ãŸã¾ã¾æ–°ã‚«ãƒ©ãƒ ã‚’è¿½åŠ 
2. **äºŒé‡æ›¸ãè¾¼ã¿æœŸé–“:** æ—§ã‚¹ã‚­ãƒ¼ãƒã¨æ–°ã‚¹ã‚­ãƒ¼ãƒã¸åŒæ™‚ã«æ›¸ãè¾¼ã¿
3. **ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ:** æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒã‚¯ãƒ•ã‚£ãƒ«
4. **èª­ã¿å–ã‚Šåˆ‡ã‚Šæ›¿ãˆ:** æ–°ã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰èª­ã¿å–ã‚Šé–‹å§‹
5. **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—:** æ¤œè¨¼å¾Œã«æ—§ã‚«ãƒ©ãƒ ã‚’å‰Šé™¤

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¾‹

```sql
-- ã‚¹ãƒ†ãƒƒãƒ—1: æ–°ã‚«ãƒ©ãƒ è¿½åŠ ï¼ˆå¾Œæ–¹äº’æ›ï¼‰
ALTER TABLE quiz_results ADD COLUMN subject TEXT DEFAULT 'math';
ALTER TABLE quiz_results ADD COLUMN result_data TEXT;  -- æŸ”è»Ÿãªä¿å­˜ã®ãŸã‚ã® JSON

-- ã‚¹ãƒ†ãƒƒãƒ—2: æ–°ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©
CREATE TABLE learning_sessions (
  id TEXT PRIMARY KEY,
  user_id TEXT,
  subject TEXT NOT NULL CHECK(subject IN ('math', 'kanji', 'kana')),
  grade_id TEXT,
  created_at INTEGER NOT NULL DEFAULT (unixepoch())
);

CREATE TABLE learning_results (
  id TEXT PRIMARY KEY,
  session_id TEXT REFERENCES learning_sessions(id),
  subject TEXT NOT NULL,
  result_data TEXT NOT NULL,  -- æ•™ç§‘åˆ¥ãƒ‡ãƒ¼ã‚¿ã‚’ JSON ã§æ ¼ç´
  correct_answer TEXT NOT NULL,
  user_answer TEXT NOT NULL,
  is_correct INTEGER NOT NULL CHECK(is_correct IN (0, 1)),
  created_at INTEGER NOT NULL DEFAULT (unixepoch())
);

CREATE INDEX idx_learning_results_session ON learning_results(session_id);
CREATE INDEX idx_learning_results_subject ON learning_results(subject);

-- ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ãƒ•ã‚£ãƒ«ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«å®Ÿè¡Œï¼‰
INSERT INTO learning_results (id, session_id, subject, result_data, correct_answer, user_answer, is_correct, created_at)
SELECT
  id,
  NULL as session_id,
  'math' as subject,
  json_object(
    'mode', mode,
    'operandA', operand_a,
    'operandB', operand_b,
    'operator', operator
  ) as result_data,
  correct_answer,
  user_answer,
  is_correct,
  created_at
FROM quiz_results
WHERE subject = 'math';
```

---

## ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥

### ãƒ‡ãƒ—ãƒ­ã‚¤é †åº

1. **DNS è¨­å®š:** ã™ã¹ã¦ã® DNS ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ§‹æˆï¼ˆã¾ã ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãªã—ï¼‰
2. **ãƒãƒ¼ã‚¿ãƒ«:** Cloudflare Pages ã¸ãƒ‡ãƒ—ãƒ­ã‚¤
3. **ç®—æ•°ã‚¢ãƒ—ãƒª:** math.edu-quest.app ã¸ãƒ‡ãƒ—ãƒ­ã‚¤
4. **ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ:** mathquest.app â†’ math.edu-quest.app ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’æœ‰åŠ¹åŒ–
5. **ç›£è¦–:** 48 æ™‚é–“ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ç›£è¦–
6. **æ¼¢å­—ï¼ã‹ãª:** æº–å‚™ã§ãæ¬¡ç¬¬ãƒ‡ãƒ—ãƒ­ã‚¤

### ãƒ‡ãƒ—ãƒ­ã‚¤ã‚³ãƒãƒ³ãƒ‰ä¾‹

```bash
# ãƒ•ã‚§ãƒ¼ã‚º1: ã‚¤ãƒ³ãƒ•ãƒ©
cd infra/terraform
terraform apply

# ãƒ•ã‚§ãƒ¼ã‚º2: ãƒãƒ¼ã‚¿ãƒ«
cd apps/portal
pnpm build
npx wrangler pages deploy dist --project-name=eduquest-portal

# ãƒ•ã‚§ãƒ¼ã‚º3: ç®—æ•°ã‚¢ãƒ—ãƒª
cd apps/edge
pnpm build
npx wrangler deploy --name=eduquest-math

# ãƒ•ã‚§ãƒ¼ã‚º4: ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
cd apps/mathquest-redirect
npx wrangler deploy --name=mathquest-redirect
```

### ç’°å¢ƒå¤‰æ•°

```bash
# .env.production (math.edu-quest.app)
CLOUDFLARE_ACCOUNT_ID=xxx
CLOUDFLARE_API_TOKEN=xxx
DATABASE_ID=xxx
KV_SESSION_ID=xxx
KV_TRIAL_ID=xxx
KV_RATE_LIMIT_ID=xxx

# Better Auth ã®è¨­å®š
AUTH_URL=https://math.edu-quest.app
AUTH_COOKIE_DOMAIN=.edu-quest.app
```

---

## ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨ˆç”»

### ç·Šæ€¥æ™‚ã®å¯¾å¿œæ‰‹é †

é‡å¤§ãªå•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆ:

1. **ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆåœæ­¢:**

   ```bash
   cd infra/terraform
   terraform apply -var="enable_redirect=false"
   ```

2. **mathquest.app ã®å¾©æ—§:**

   - mathquest.app ã‚’å¾“æ¥ã® Workers ã«æˆ»ã™ã‚ˆã† DNS ã‚’å†è¨­å®š
   - æ–°ã—ã„ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’åœæ­¢

3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯:**

   - é©ç”¨æ¸ˆã¿ã®ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ã‚’ä¿å­˜æ¸ˆã¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å·»ãæˆ»ã™
   - å¿…è¦ã«å¿œã˜ã¦ D1 ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ

4. **ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³:**
   - SNS ã‚„ã‚¢ãƒ—ãƒªå†…ã§çŠ¶æ³ã‚’å‘ŠçŸ¥
   - èªè¨¼ã«å½±éŸ¿ãŒã‚ã£ãŸå ´åˆã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ãƒ¡ãƒ¼ãƒ«é€šçŸ¥

### ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ¤œè¨¼

- [ ] mathquest.app ãŒå…ƒã®ã‚¢ãƒ—ãƒªã‚’æä¾›ã—ã¦ã„ã‚‹
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒç¶­æŒã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªãŒæˆåŠŸã™ã‚‹
- [ ] ãƒ‡ãƒ¼ã‚¿æå¤±ãŒãªã„

---

## æˆåŠŸæŒ‡æ¨™

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™

- **ãƒšãƒ¼ã‚¸è¡¨ç¤ºé€Ÿåº¦:** P95 ã§ 1.5 ç§’æœªæº€
- **API å¿œç­”æ™‚é–“:** P95 ã§ 200ms æœªæº€
- **ã‚¨ãƒ©ãƒ¼ãƒ¬ãƒ¼ãƒˆ:** 0.1% æœªæº€
- **ç¨¼åƒç‡:** 99.9% ä»¥ä¸Š

### ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡æ¨™

- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¶™ç¶šç‡:** ç¾çŠ¶ç¶­æŒã¾ãŸã¯æ”¹å–„
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³æ™‚é–“:** ç¾çŠ¶ç¶­æŒã¾ãŸã¯æ”¹å–„
- **ã‚¯ã‚¤ã‚ºå®Œäº†ç‡:** ç¾çŠ¶ç¶­æŒã¾ãŸã¯æ”¹å–„
- **æ•™ç§‘é–“åˆ©ç”¨:** è¤‡æ•°æ•™ç§‘ã‚’åˆ©ç”¨ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã‚’è¿½è·¡

### æŠ€è¡“æŒ‡æ¨™

- **ãƒ“ãƒ«ãƒ‰æ™‚é–“:** 2 åˆ†æœªæº€
- **ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚é–“:** 1 åˆ†æœªæº€
- **DB ã‚¯ã‚¨ãƒªæ™‚é–“:** P95 ã§ 50ms æœªæº€
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡:** 80% ä»¥ä¸Š

---

## ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æ¦‚è¦

| ãƒ•ã‚§ãƒ¼ã‚º                    | æœŸé–“     | ä¸»è¦æˆæœç‰©                                   |
| --------------------------- | -------- | -------------------------------------------- |
| ãƒ•ã‚§ãƒ¼ã‚º1: åŸºç›¤æ•´å‚™         | 2 é€±é–“   | ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®šã€DNSã€SSL                       |
| ãƒ•ã‚§ãƒ¼ã‚º2: MathQuest ç§»è¡Œ   | 2 é€±é–“   | math.edu-quest.app ç¨¼åƒã€ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå®Œäº†    |
| ãƒ•ã‚§ãƒ¼ã‚º3: ãƒãƒ¼ã‚¿ãƒ«é–‹ç™º     | 4 é€±é–“   | edu-quest.app ãƒãƒ¼ã‚¿ãƒ«å…¬é–‹                   |
| ãƒ•ã‚§ãƒ¼ã‚º4: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° | 4 é€±é–“   | è¤‡æ•°æ•™ç§‘å¯¾å¿œã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£                   |
| ãƒ•ã‚§ãƒ¼ã‚º5: æ–°ã‚¢ãƒ—ãƒªé–‹ç™º     | 6 é€±é–“ã€œ | kanji.edu-quest.appã€kana.edu-quest.app å…¬é–‹ |

**æƒ³å®šç·æœŸé–“:** 18 é€±é–“ä»¥ä¸Šï¼ˆç´„ 4.5 ã‹æœˆï¼‰

---

## ä»Šå¾Œã®é€²ã‚æ–¹

1. âœ… ç§»è¡Œè¨ˆç”»ã‚’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–ï¼ˆæœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰
2. â¬œ `edu-quest.app` ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å–å¾—
3. â¬œ DNS ç®¡ç†ç”¨ Terraform ã‚’æ•´å‚™
4. â¬œ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã¨æ‹…å½“è€…ã‚’æ±ºå®š
5. â¬œ ãƒ•ã‚§ãƒ¼ã‚º1ã®å®Ÿè£…ã‚’é–‹å§‹

---

## æ¤œè¨ãƒ»æ±ºå®šãŒå¿…è¦ãªäº‹é …

- [ ] **ãƒ‰ãƒ¡ã‚¤ãƒ³è³¼å…¥:** edu-quest.app ã‚’èª°ãŒå–å¾—ã™ã‚‹ã‹
- [ ] **äºˆç®—:** Cloudflare Pages ã¨ Workers ã®æ¦‚ç®—ã‚³ã‚¹ãƒˆ
- [ ] **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹:** æ•™ç§‘ã”ã¨ã« D1 ã‚’åˆ†ã‘ã‚‹ã‹å…±æœ‰ã™ã‚‹ã‹
- [ ] **åˆ†æåŸºç›¤:** ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã”ã¨ã« Google Analytics ã‚’åˆ†ã‘ã‚‹ã‹çµ±åˆã™ã‚‹ã‹
- [ ] **CDN:** é™çš„ã‚¢ã‚»ãƒƒãƒˆé…ä¿¡ã« Cloudflare R2 ã‚’ä½¿ã†ã‹

---

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³:** 1.0
**æœ€çµ‚æ›´æ–°æ—¥:** 2025-10-18
**ä½œæˆè€…:** AI Assistant (Claude)
**æ‰¿èªè€…:** ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚ªãƒ¼ãƒŠãƒ¼
