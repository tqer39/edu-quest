[🇺🇸 English](/docs/kokugo-quest-design.md)

# KokugoQuest 設計ドキュメント

## 概要

KokugoQuestは、小学生向けの包括的な国語学習プラットフォームです。漢字・用語・部首をゲーム形式のクイズと参照用辞書で学習できます。

## 対象ユーザー

- 小学生（1年生〜6年生）
- 年齢層：6〜12歳
- 文部科学省の学習指導要領に沿った国語学習（漢字・用語・部首）

## コア機能

KokugoQuestは2つの主要コンポーネントで構成されています：

1. **クエストモード**: 漢字の読み方と画数を練習する対話型クイズ
2. **辞書モード**: 漢字・用語・部首の参照資料

## クエストタイプ

### 1. 漢字の読みクエスト

**目的**: 漢字の正しい読み方（音読み/訓読み）を学ぶ

**問題形式**:

```text
表示: 学校
問題: この漢字の読み方は？
選択肢:
  A) がっこう ✓
  B) がくこう
  C) がくしょう
  D) がっしょう
```

**難易度レベル**:

- かんたん: ふりがな付きの一文字の漢字
- ふつう: 2文字の熟語
- むずかしい: 3文字以上の熟語、ヒントなし

**ヒント機能**:

- レベル1: 部分的なふりがなを表示
- レベル2: 部首をハイライト表示
- レベル3: 筆順アニメーション

---

### 2. 漢字の画数クエスト

**目的**: 漢字の正しい画数を学ぶ

**問題形式**:

```text
表示: 学
問題: この漢字の画数は？
選択肢:
  A) 6画
  B) 7画
  C) 8画 ✓
  D) 9画
```

**学習効果**:

- 漢字の書き方スキルを強化
- 視覚的分析能力を向上
- 辞書検索スキルの基礎を構築

---

### 3. 今後のクエストタイプ（予定）

以下のクエストタイプは今後のフェーズで検討中です：

#### 送り仮名クエスト

**目的**: 正しい送り仮名の使い方を身につける

**問題形式**:

```text
表示: 書___
問題: 正しい送り仮名を選ぼう！
選択肢:
  A) 書く ✓
  B) 書き
  C) 書い
  D) 書け
```

#### 漢字パズルクエスト

**目的**: 漢字の成り立ちと部首を理解する

**問題形式 - タイプA（組み合わせ）**:

```text
問題: 2つの漢字を組み合わせて新しい漢字を作ろう！
表示: 「木」 + 「木」 = ?
選択肢:
  A) 林 ✓
  B) 森
  C) 材
  D) 村
```

**問題形式 - タイプB（分解）**:

```text
問題: この漢字はどの部首からできている？
表示: 「明」
選択肢:
  A) 日 + 月 ✓
  B) 日 + 目
  C) 白 + 月
  D) 白 + 目
```

**ヒント機能**:

- 部首の意味を表示
- 漢字の成り立ちアニメーション
- 語呂合わせヒント

---

## 辞書機能

KokugoQuestは `/kokugo/learn` から3種類の参照辞書を提供しています：

### 1. 漢字辞書

- 学年別に漢字を参照
- 読み方（音読み/訓読み）、意味、画数を表示
- その漢字を使った例文を表示
- 漢字を含む用語エントリへリンク

### 2. 用語辞書

- 学年別に用語を参照
- 読み方、意味、漢字分解を表示
- 漢字辞書エントリへの相互参照
- 準備中

### 3. 部首辞書

- 漢字の構成要素（へん・つくり・かんむり）を学習
- 部首から漢字を検索
- 文字構造と語源を理解
- 準備中

---

## ゲーミフィケーション機能

### 🏆 ストーリーモード: 「漢字王国の冒険」

学年レベルを王国として進行:

1. **1年生の村** (80漢字)

   - テーマ: 日常生活の漢字
   - バッジ: 🌱 漢字の芽

2. **2年生の町** (160漢字)

   - テーマ: 自然と動物
   - バッジ: 🌿 漢字の双葉

3. **3年生の市** (200漢字)

   - テーマ: 動作と感情
   - バッジ: 🌳 漢字の木

4. **4年生の城** (202漢字)

   - テーマ: 社会と文化
   - バッジ: 🏯 漢字の守護者

5. **5年生の宮殿** (193漢字)

   - テーマ: 抽象的な概念
   - バッジ: 👑 漢字マスター

6. **6年生の王国** (191漢字)
   - テーマ: 高度な語彙
   - バッジ: ⭐ 漢字皇帝

### ⚔️ ボスバトルモード

- 学年レベルの80%を完了すると解放
- 難易度の高い熟語に挑戦
- 例:
  - 四字熟語（一石二鳥など）
  - 難読漢字（薔薇など）
  - 同音異義語（橋・箸・端など）

### 🎯 タイムアタックモード

- 1問あたり30秒の制限時間
- コンボシステム:
  - 3問連続正解 → ⭐ +10点
  - 5問連続正解 → ⭐ +20点
  - 10問連続正解 → ⭐ +50点

---

## 機能実装ロードマップ

### フェーズ1: MVP（最小限の機能）

- [ ] 読み方クエストの実装
- [ ] 学年選択（1〜6年生）
- [ ] 基本的な採点システム
- [ ] 問題数設定（5/10/20問）
- [ ] シンプルな結果画面

### フェーズ2: 機能強化

- [ ] 送り仮名クエスト
- [ ] 漢字パズルクエスト
- [ ] ヒントシステム（3種類）
- [ ] 効果音のON/OFF切り替え
- [ ] 学習進捗の記録

### フェーズ3: 高度な機能

- [ ] ストーリーモードの進行
- [ ] ボスバトルモード
- [ ] タイムアタックモード
- [ ] 音声読み上げ機能
- [ ] 実績とバッジシステム
- [ ] 日替わりチャレンジ

---

## 技術アーキテクチャ

### ドメイン層（`@edu-quest/domain`）

```typescript
// 漢字データ構造
interface Kanji {
  character: string;
  grade: 1 | 2 | 3 | 4 | 5 | 6;
  readings: {
    onyomi: string[]; // 音読み
    kunyomi: string[]; // 訓読み
  };
  meanings: string[];
  radicals: string[];
  strokeCount: number;
  examples: string[]; // 熟語例
}

// 問題タイプ
type KokugoQuestionType =
  | 'kanji-reading' // 読み方クエスト
  | 'okurigana' // 送り仮名クエスト
  | 'puzzle' // 漢字パズルクエスト
  | 'radical' // 部首クエスト
  | 'compound'; // 熟語クエスト

// 問題生成クラス
class KokugoQuestionGenerator {
  generateReadingQuestion(kanji: Kanji, difficulty: Difficulty): Question;
  generateOkuriganaQuestion(verb: Kanji, difficulty: Difficulty): Question;
  generatePuzzleQuestion(kanjis: Kanji[], difficulty: Difficulty): Question;
}
```

### アプリケーション層（`@edu-quest/app`）

```typescript
// クイズセッション管理
class KanjiQuizSession {
  grade: number;
  questionType: KokugoQuestionType;
  questionCount: number;
  currentQuestion: number;
  score: number;
  hints: HintState;
}

// 答え合わせ
class KanjiAnswerVerifier {
  verify(answer: string, correctAnswer: string): VerificationResult;
  getHint(question: Question, hintLevel: number): Hint;
}
```

**セッションストレージ戦略:**

KokugoQuest はサーバーサイドのセッション管理に **Cloudflare KV** を使用します：

- セッションデータは `KV_QUIZ_SESSION` にキーパターン `kanji:{sessionId}` で保存
- HttpOnly Cookie にはセッション ID のみを保存（`kanji_session_id`）
- アクティブセッション TTL: 1800秒（30分）
- 結果セッション TTL: 300秒（5分）
- クイズ完了時にセッションを KV から削除

このアプローチはセキュリティ（XSS/CSRF 対策）とスケーラビリティ（分散 KV ストレージ）を提供します。詳細なガイドラインは [AGENTS.md セクション 7](../AGENTS.md#7-session-management-policy) を参照してください。

### Edge層（`@edu-quest/edge`）

```typescript
// ルーティング
GET  /kokugo              → トップページ
GET  /kokugo/start        → 設定画面（学年とクエストタイプ選択）
GET  /kokugo/play         → 練習セッション
GET  /kokugo/learn        → 辞書選択ページ
GET  /kokugo/dictionary   → 漢字辞書
POST /apis/kokugo/quiz    → クイズAPI
```

---

## UI/UXデザイン原則

### カラーテーマ

- メイン: パープル（`#9B7EC8`）- 神秘と学習
- サブ: ピンク（`#E89AC7`）- フレンドリーで親しみやすい
- アクセント: ゴールド（`#FFD700`）- 達成と成功

### ビジュアル要素

- **ふりがな表示**: 漢字の上に小さなルビテキスト
- **筆順アニメーション**: 書き順の視覚的ガイド
- **部首ハイライト**: 色分けされた部首の構成要素
- **進捗バー**: 完了状況の視覚的フィードバック

### 効果音

- ✅ 正解: 明るいチャイム音
- ❌ 不正解: やさしいブザー音
- 🎯 コンボ達成: 勝利ファンファーレ
- ⏱️ 時間警告: カチカチ音
- 🏆 レベルアップ: 盛大な祝賀音

### アクセシビリティ

- フォントサイズ: 漢字は最低20px
- 高コントラストモードで読みやすく
- すべてのテキストに音声読み上げオプション
- キーボードナビゲーション対応

---

## データソース

### 漢字データベース

文部科学省（MEXT）の公式教育漢字リストを使用:

- 小学1年生: 80漢字
- 小学2年生: 160漢字
- 小学3年生: 200漢字
- 小学4年生: 202漢字
- 小学5年生: 193漢字
- 小学6年生: 191漢字
- **合計**: 1,026字（教育漢字）

### データ構造例

```json
{
  "character": "学",
  "grade": 1,
  "readings": {
    "onyomi": ["ガク"],
    "kunyomi": ["まな-ぶ"]
  },
  "meanings": ["study", "learning", "science"],
  "radicals": ["子"],
  "strokeCount": 8,
  "examples": [
    { "word": "学校", "reading": "がっこう", "meaning": "学校" },
    { "word": "学生", "reading": "がくせい", "meaning": "学生" },
    { "word": "学ぶ", "reading": "まなぶ", "meaning": "学ぶ" }
  ]
}
```

---

## 成功指標

### 学習成果

- 漢字認識率の向上
- 読解速度の向上
- 定着率（1週間後、1ヶ月後）
- 学年別の完了率

### エンゲージメント指標

- 1日あたりのアクティブユーザー数
- 平均セッション時間
- セッションあたりの問題数
- リピート率（翌日、翌週）

### 機能採用率

- 最も人気のあるクエストタイプ
- ヒント使用頻度
- タイムアタック参加率
- ストーリーモード進行率

---

## 今後の拡張機能

### 高度な機能（フェーズ4以降）

- **マルチプレイヤーモード**: 友達とリアルタイムで競争
- **カスタムフラッシュカード**: オリジナルの学習セット作成
- **手書き認識**: タッチスクリーンで漢字を書く練習
- **間隔反復学習**: 最適な復習タイミングのアルゴリズム
- **保護者ダッシュボード**: 学習進捗と分析データ
- **学校カリキュラム連携**: 特定の教科書に対応

### 多言語対応

- 繁体字（台湾・香港）対応
- 簡体字（中国本土）対応
- 英語学習モード（漢字→英語の意味）

---

## 参考資料

- [文部科学省 学年別漢字配当表](https://www.mext.go.jp/)
- [常用漢字表](https://ja.wikipedia.org/wiki/常用漢字)
- [教育漢字](https://ja.wikipedia.org/wiki/教育漢字)
