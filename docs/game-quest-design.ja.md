# GameQuest 設計ドキュメント

## 概要

GameQuest は、基礎的な算数学力・空間認識・論理的思考を楽しいチャレンジ形式で強化する脳トレ系ミニゲームのコレクションです。各ゲームは 60〜120 秒の短時間で完結し、テンポの良いフィードバックを提供して学習意欲を保ちます。

## 実装済みミニゲーム: Stellar Balance

**概要**: Stellar Balance は GameQuest で最初に遊べるパズルで、6×6 の宇宙タイルをルールに沿って配置してバランスを整えます。

### プレイ概要

- 太陽 (☀️)・月 (🌙)・星 (⭐) の 3 種類のタイルで全マスを埋める。
- 各行・各列にそれぞれのタイルがちょうど 2 枚ずつ入るように配置する。
- 同じタイルがタテ・ヨコで隣り合わないように並べる。
- いくつかのマスは初期状態でロックされ、ヒントで表示したマスもロック対象になる。
- パレットで設置するタイルを選び、スポンジボタンでマスを空に戻せる。

### 難易度セットと学年対応

- **Gentle**（小学1〜2年向け）: ヒント多めでバランス感覚に慣れるセット。
- **Steady**（小学2〜6年向け）: 行・列の枚数カウントに集中できるヒント量。
- **Expert**（小学2〜6年向け）: 最小限のヒントで推論力と隣接ルールを重視するセット。
- ページ表示ごとにランダムでパズルを選択し、繰り返し遊んでも新鮮さを保つ。

### UX メモ

- 置いた太陽・月・星の枚数をリアルタイムに表示し、各 12 枚の目標と比較できる。
- 「バランスを判定」ボタンでルールを総合チェックし、違反マスを強調表示。クリア時は祝福演出を表示。
- 1 マスヒント、リセット、別パズル再読み込みの各ボタンを用意。
- GameQuest のグリーンパレットと柔らかいグラデーションで、MathQuest / ClockQuest との差別化を図る。

## 対象ユーザー

- 小学生（1〜6 年生）
- 体験的なゲーム学習を好む学習者
- MathQuest のステージを修了し、追加のスキル強化を求める生徒

## コアゲームモード

### 1. パターンスプリント

**目的**: 素早い数列問題から欠けている数を見つけ、暗算力を鍛える。

**ゲームの流れ**:

1. 4 つの数字から 1 タイルだけ隠した数列を表示（例: `3, 6, __, 12`）。
2. 生徒は 10 秒以内に 4 つの選択肢から正しい数字を選ぶ。
3. 連続正解でコンボ演出とボーナスポイントが発生。

**難易度スケーリング**:

- 初級: 20 までの加減算パターン
- 中級: 9×9 までの乗除算パターン
- 上級: 複合演算や 2 ステップ数列

---

### 2. シェイプビルダー

**目的**: タングラム風シルエットを組み立て、空間認識力を高める。

**ゲームの流れ**:

1. 画面右側にターゲットシルエットを表示。
2. 左側に三角形・正方形・長方形などのジオメトリタイルを提示。
3. タイルをドラッグ＆回転して制限時間内にシルエットを完成させる。

**ヒントシステム**:

- ヒント1: 正しいタイルの輪郭をハイライト
- ヒント2: 選択タイルを正しい回転角にスナップ
- ヒント3: 完成イメージの半透明オーバーレイを表示

---

### 3. メモリーマッチクエスト

**目的**: 計算記号や語彙をカード合わせゲームで定着させる。

**ゲームの流れ**:

1. 4x4 の伏せカードグリッドを表示。
2. 1 ターンに 2 枚めくり、ペア（例: 数字と式、記号と名称）を見つける。
3. ペア成立で制限時間を延長し、不一致の場合は教育的なヒントを短時間表示。

**カードテーマ**:

- 数字と式（例: `8` ↔ `4 + 4`）
- 時計の文字盤と時間表現
- 図形と定義

---

## 進行と報酬

- **ステージレベル**: 各モードに 1〜6 年生プリセットを用意し、難易度を段階調整。
- **デイリーミッション**: 「シェイプビルダーを 2 回クリア」など、バラエティを促す 3 種のチャレンジが日替わりで登場。
- **実績バッジ**:
  - 🎯 コンボキャプテン – パターンスプリントで 10 連続正解
  - 🧩 マスタービルダー – ヒントを使わずにシェイプビルダーを 3 問クリア
  - 🧠 メモリーセージ – 90 秒以内にメモリーマッチクエストをクリア

## アクセシビリティ配慮

- タイマー長を 30/60/90 秒から選択可能
- カラーブラインド対応パレットとハイコントラストモードを用意
- 「残り 10 秒！」「コンボボーナス！」など重要イベントで音声ガイドを再生

## 技術メモ

- 共有クイズセッションマネージャーを再利用し、KV ストレージに `game` 名前空間を追加。
- 各ミニゲームは `@edu-quest/domain` で解析できる標準化スコア payload を提供。
- フロントエンドコンポーネントは既存の Hono SSR レイアウトを継承し、クエスト単位のテーマ API を共有。
